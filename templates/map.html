<html>
<head>
    <title>deck.gl ColumnLayer Example</title>

    <script src="https://unpkg.com/deck.gl@^8.8.0/dist.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet"/>

    <style type="text/css">
        body {
            width: 100vw;
            height: 100vh;
            margin: 0;
        }
    </style>
</head>

<body>
<div id="map" style="width: 100%; height: 100%;"></div>

<script>
    const token = 'pk.eyJ1IjoiZGlhbmFtZW93IiwiYSI6ImNqcmh4aWJnOTIxemI0NXA0MHYydGwzdm0ifQ.9HakB25m0HLT-uDY2yat7A';
    const data = {{ data|safe }};
    const startAge = {{ start_age }};
    const endAge = {{ end_age }};
    const maxElevation = {{ max_elevation }};
    const minElevation = {{ min_elevation }};
    const scale = {{ scale }};

    const { DeckGL, ColumnLayer } = deck;

    function ryb2rgb(r, y, b) {
        // Your ryb2rgb implementation here
    }

    new DeckGL({
        mapboxApiAccessToken: token,
        mapStyle: 'mapbox://styles/mapbox/dark-v10',
        initialViewState: {
            container: 'map',
            longitude: -1.932311,
            latitude: 51.923,
            pitch: 60,
            bearing: 0,
            minZoom: 5,
            zoom: 7,
        },

        controller: true,
        layers: [
            new ColumnLayer({
                id: 'column',
                data: data,
                diskResolution: 12,
                radius: 1000,
                elevationScale: scale,
                getPosition: (d) => [d.Longitude, d.Latitude],
                getFillColor: (d) => [d.red, d.green, 0, 160],
                getElevation: (d) => d.elevation,
            }),
        ],
    });
</script>
</body>
</html>
